import{h5 as qe,h6 as ve,r as w,h7 as Ke,d as Q,F as B,b as Ge,cb as Ye,cn as Re,u as K,a9 as he,cj as me,bk as ne,ah as J,cl as oe,co as we,j as d,bo as pe,ev as k,$ as Ce,i as Qe,h8 as Je,W as Z,ai as Xe,aj as Ze,T as Te,ct as fe,cy as se,V as ie,B as V,eS as xe,I as ae,eT as Me,aw as De,bj as Le,aE as et}from"./strapi-Cdgn8T7P.js";import{u as je,I as Oe,D as ke}from"./useDragAndDrop-HYwNDExe-ulySukYe.js";import{a as ze,g as re,u as tt,b as nt}from"./relations-De8hSklO-P8smWhL7.js";import{g as Ee}from"./getEmptyImage-CjqolaH3.js";var be=Number.isNaN||function(n){return typeof n=="number"&&n!==n};function ot(t,n){return!!(t===n||be(t)&&be(n))}function it(t,n){if(t.length!==n.length)return!1;for(var o=0;o<t.length;o++)if(!ot(t[o],n[o]))return!1;return!0}function de(t,n){n===void 0&&(n=it);var o,c=[],u,v=!1;function I(){for(var _=[],T=0;T<arguments.length;T++)_[T]=arguments[T];return v&&o===this&&n(_,c)||(u=t.apply(this,_),v=!0,o=this,c=_),u}return I}var at=typeof performance=="object"&&typeof performance.now=="function",_e=at?function(){return performance.now()}:function(){return Date.now()};function ye(t){cancelAnimationFrame(t.id)}function st(t,n){var o=_e();function c(){_e()-o>=n?t.call(null):u.id=requestAnimationFrame(c)}var u={id:requestAnimationFrame(c)};return u}var ue=-1;function Ie(t){if(t===void 0&&(t=!1),ue===-1||t){var n=document.createElement("div"),o=n.style;o.width="50px",o.height="50px",o.overflow="scroll",document.body.appendChild(n),ue=n.offsetWidth-n.clientWidth,document.body.removeChild(n)}return ue}var Y=null;function Se(t){if(t===void 0&&(t=!1),Y===null||t){var n=document.createElement("div"),o=n.style;o.width="50px",o.height="50px",o.overflow="scroll",o.direction="rtl";var c=document.createElement("div"),u=c.style;return u.width="100px",u.height="100px",n.appendChild(c),document.body.appendChild(n),n.scrollLeft>0?Y="positive-descending":(n.scrollLeft=1,n.scrollLeft===0?Y="negative":Y="positive-ascending"),document.body.removeChild(n),Y}return Y}var rt=150,lt=function(n,o){return n},ee=null,te=null;typeof window<"u"&&typeof window.WeakSet<"u"&&(ee=new WeakSet,te=new WeakSet);function ct(t){var n,o=t.getItemOffset,c=t.getEstimatedTotalSize,u=t.getItemSize,v=t.getOffsetForIndexAndAlignment,I=t.getStartIndexForOffset,_=t.getStopIndexForStartIndex,T=t.initInstanceProps,M=t.shouldResetStyleCacheOnItemSizeChange,D=t.validateProps;return n=function(x){qe(j,x);function j(b){var e;return e=x.call(this,b)||this,e._instanceProps=T(e.props,ve(e)),e._outerRef=void 0,e._resetIsScrollingTimeoutId=null,e.state={instance:ve(e),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof e.props.initialScrollOffset=="number"?e.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},e._callOnItemsRendered=void 0,e._callOnItemsRendered=de(function(r,l,m,f){return e.props.onItemsRendered({overscanStartIndex:r,overscanStopIndex:l,visibleStartIndex:m,visibleStopIndex:f})}),e._callOnScroll=void 0,e._callOnScroll=de(function(r,l,m){return e.props.onScroll({scrollDirection:r,scrollOffset:l,scrollUpdateWasRequested:m})}),e._getItemStyle=void 0,e._getItemStyle=function(r){var l=e.props,m=l.direction,f=l.itemSize,h=l.layout,p=e._getItemStyleCache(M&&f,M&&h,M&&m),y;if(p.hasOwnProperty(r))y=p[r];else{var i=o(e.props,r,e._instanceProps),a=u(e.props,r,e._instanceProps),R=m==="horizontal"||h==="horizontal",g=m==="rtl",E=R?i:0;p[r]=y={position:"absolute",left:g?void 0:E,right:g?E:void 0,top:R?0:i,height:R?"100%":a,width:R?a:"100%"}}return y},e._getItemStyleCache=void 0,e._getItemStyleCache=de(function(r,l,m){return{}}),e._onScrollHorizontal=function(r){var l=r.currentTarget,m=l.clientWidth,f=l.scrollLeft,h=l.scrollWidth;e.setState(function(p){if(p.scrollOffset===f)return null;var y=e.props.direction,i=f;if(y==="rtl")switch(Se()){case"negative":i=-f;break;case"positive-descending":i=h-m-f;break}return i=Math.max(0,Math.min(i,h-m)),{isScrolling:!0,scrollDirection:p.scrollOffset<i?"forward":"backward",scrollOffset:i,scrollUpdateWasRequested:!1}},e._resetIsScrollingDebounced)},e._onScrollVertical=function(r){var l=r.currentTarget,m=l.clientHeight,f=l.scrollHeight,h=l.scrollTop;e.setState(function(p){if(p.scrollOffset===h)return null;var y=Math.max(0,Math.min(h,f-m));return{isScrolling:!0,scrollDirection:p.scrollOffset<y?"forward":"backward",scrollOffset:y,scrollUpdateWasRequested:!1}},e._resetIsScrollingDebounced)},e._outerRefSetter=function(r){var l=e.props.outerRef;e._outerRef=r,typeof l=="function"?l(r):l!=null&&typeof l=="object"&&l.hasOwnProperty("current")&&(l.current=r)},e._resetIsScrollingDebounced=function(){e._resetIsScrollingTimeoutId!==null&&ye(e._resetIsScrollingTimeoutId),e._resetIsScrollingTimeoutId=st(e._resetIsScrolling,rt)},e._resetIsScrolling=function(){e._resetIsScrollingTimeoutId=null,e.setState({isScrolling:!1},function(){e._getItemStyleCache(-1,null)})},e}j.getDerivedStateFromProps=function(e,r){return dt(e,r),D(e),null};var S=j.prototype;return S.scrollTo=function(e){e=Math.max(0,e),this.setState(function(r){return r.scrollOffset===e?null:{scrollDirection:r.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},S.scrollToItem=function(e,r){r===void 0&&(r="auto");var l=this.props,m=l.itemCount,f=l.layout,h=this.state.scrollOffset;e=Math.max(0,Math.min(e,m-1));var p=0;if(this._outerRef){var y=this._outerRef;f==="vertical"?p=y.scrollWidth>y.clientWidth?Ie():0:p=y.scrollHeight>y.clientHeight?Ie():0}this.scrollTo(v(this.props,e,r,h,this._instanceProps,p))},S.componentDidMount=function(){var e=this.props,r=e.direction,l=e.initialScrollOffset,m=e.layout;if(typeof l=="number"&&this._outerRef!=null){var f=this._outerRef;r==="horizontal"||m==="horizontal"?f.scrollLeft=l:f.scrollTop=l}this._callPropsCallbacks()},S.componentDidUpdate=function(){var e=this.props,r=e.direction,l=e.layout,m=this.state,f=m.scrollOffset,h=m.scrollUpdateWasRequested;if(h&&this._outerRef!=null){var p=this._outerRef;if(r==="horizontal"||l==="horizontal")if(r==="rtl")switch(Se()){case"negative":p.scrollLeft=-f;break;case"positive-ascending":p.scrollLeft=f;break;default:var y=p.clientWidth,i=p.scrollWidth;p.scrollLeft=i-y-f;break}else p.scrollLeft=f;else p.scrollTop=f}this._callPropsCallbacks()},S.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&ye(this._resetIsScrollingTimeoutId)},S.render=function(){var e=this.props,r=e.children,l=e.className,m=e.direction,f=e.height,h=e.innerRef,p=e.innerElementType,y=e.innerTagName,i=e.itemCount,a=e.itemData,R=e.itemKey,g=R===void 0?lt:R,E=e.layout,F=e.outerElementType,A=e.outerTagName,$=e.style,C=e.useIsScrolling,L=e.width,s=this.state.isScrolling,O=m==="horizontal"||E==="horizontal",N=O?this._onScrollHorizontal:this._onScrollVertical,P=this._getRangeToRender(),z=P[0],U=P[1],G=[];if(i>0)for(var X=z;X<=U;X++)G.push(w.createElement(r,{data:a,key:g(X,a),index:X,isScrolling:C?s:void 0,style:this._getItemStyle(X)}));var ge=c(this.props,this._instanceProps);return w.createElement(F||A||"div",{className:l,onScroll:N,ref:this._outerRefSetter,style:Ke({position:"relative",height:f,width:L,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:m},$)},w.createElement(p||y||"div",{children:G,ref:h,style:{height:O?"100%":ge,pointerEvents:s?"none":void 0,width:O?ge:"100%"}}))},S._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var e=this.props.itemCount;if(e>0){var r=this._getRangeToRender(),l=r[0],m=r[1],f=r[2],h=r[3];this._callOnItemsRendered(l,m,f,h)}}if(typeof this.props.onScroll=="function"){var p=this.state,y=p.scrollDirection,i=p.scrollOffset,a=p.scrollUpdateWasRequested;this._callOnScroll(y,i,a)}},S._getRangeToRender=function(){var e=this.props,r=e.itemCount,l=e.overscanCount,m=this.state,f=m.isScrolling,h=m.scrollDirection,p=m.scrollOffset;if(r===0)return[0,0,0,0];var y=I(this.props,p,this._instanceProps),i=_(this.props,y,p,this._instanceProps),a=!f||h==="backward"?Math.max(1,l):1,R=!f||h==="forward"?Math.max(1,l):1;return[Math.max(0,y-a),Math.max(0,Math.min(r-1,i+R)),y,i]},j}(w.PureComponent),n.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},n}var dt=function(n,o){var c=n.children,u=n.direction,v=n.height,I=n.layout,_=n.innerTagName,T=n.outerTagName,M=n.width,D=o.instance;{(_!=null||T!=null)&&te&&!te.has(D)&&(te.add(D),console.warn("The innerTagName and outerTagName props have been deprecated. Please use the innerElementType and outerElementType props instead."));var x=u==="horizontal"||I==="horizontal";switch(u){case"horizontal":case"vertical":ee&&!ee.has(D)&&(ee.add(D),console.warn('The direction prop should be either "ltr" (default) or "rtl". Please use the layout prop to specify "vertical" (default) or "horizontal" orientation.'));break;case"ltr":case"rtl":break;default:throw Error('An invalid "direction" prop has been specified. Value should be either "ltr" or "rtl". '+('"'+u+'" was specified.'))}switch(I){case"horizontal":case"vertical":break;default:throw Error('An invalid "layout" prop has been specified. Value should be either "horizontal" or "vertical". '+('"'+I+'" was specified.'))}if(c==null)throw Error('An invalid "children" prop has been specified. Value should be a React component. '+('"'+(c===null?"null":typeof c)+'" was specified.'));if(x&&typeof M!="number")throw Error('An invalid "width" prop has been specified. Horizontal lists must specify a number for width. '+('"'+(M===null?"null":typeof M)+'" was specified.'));if(!x&&typeof v!="number")throw Error('An invalid "height" prop has been specified. Vertical lists must specify a number for height. '+('"'+(v===null?"null":typeof v)+'" was specified.'))}},Fe=ct({getItemOffset:function(n,o){var c=n.itemSize;return o*c},getItemSize:function(n,o){var c=n.itemSize;return c},getEstimatedTotalSize:function(n){var o=n.itemCount,c=n.itemSize;return c*o},getOffsetForIndexAndAlignment:function(n,o,c,u,v,I){var _=n.direction,T=n.height,M=n.itemCount,D=n.itemSize,x=n.layout,j=n.width,S=_==="horizontal"||x==="horizontal",b=S?j:T,e=Math.max(0,M*D-b),r=Math.min(e,o*D),l=Math.max(0,o*D-b+D+I);switch(c==="smart"&&(u>=l-b&&u<=r+b?c="auto":c="center"),c){case"start":return r;case"end":return l;case"center":{var m=Math.round(l+(r-l)/2);return m<Math.ceil(b/2)?0:m>e+Math.floor(b/2)?e:m}case"auto":default:return u>=l&&u<=r?u:u<l?l:r}},getStartIndexForOffset:function(n,o){var c=n.itemCount,u=n.itemSize;return Math.max(0,Math.min(c-1,Math.floor(o/u)))},getStopIndexForStartIndex:function(n,o,c){var u=n.direction,v=n.height,I=n.itemCount,_=n.itemSize,T=n.layout,M=n.width,D=u==="horizontal"||T==="horizontal",x=o*_,j=D?M:v,S=Math.ceil((j+c-x)/_);return Math.max(0,Math.min(I-1,o+S-1))},initInstanceProps:function(n){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(n){var o=n.itemSize;if(typeof o!="number")throw Error('An invalid "itemSize" prop has been specified. Value should be a number. '+('"'+(o===null?"null":typeof o)+'" was specified.'))}});const[Rt,$e]=Ye("ComponentContext",{id:void 0,level:-1,uid:void 0,type:void 0});function le(t,n){const o=J(t),c=ne(n,I=>I.removeFieldRow),u=ne(n,I=>I.addFieldRow);return I=>{if(o.value&&o.value.connect){const _=o.value.connect.findIndex(T=>T.id===I.id);if(_>=0){c(`${t}.connect`,_);return}}u(`${t}.disconnect`,{id:I.id,apiData:{id:I.id,documentId:I.documentId,locale:I.locale}})}}const W=5,ce=["oneWay","oneToOne","manyToOne","oneToManyMorph","oneToOneMorph"],ut=w.forwardRef(({disabled:t,label:n,...o},c)=>{const[u,v]=w.useState(1),{document:I,model:_}=Re(),T=I?.documentId,{formatMessage:M}=K(),[{query:D}]=he(),x=me(D),S=o.attribute.relation.toLowerCase().includes("morph")||t,{componentId:b,componentUID:e}=$e("RelationsField",({uid:s,id:O})=>({componentId:O,componentUID:s})),r=ne("RelationsList",s=>s.isSubmitting);w.useEffect(()=>{v(1)},[r]);const l=b?b.toString():T,m=e??_,[f]=o.name.split(".").slice(-1),{data:h,isLoading:p,isFetching:y}=ze({model:m,targetField:f,id:l,params:{...x,pageSize:W,page:u}},{refetchOnMountOrArgChange:!0,skip:!l,selectFromResult:s=>({...s,data:{...s.data,results:s.data?.results?s.data.results:[]}})}),i=()=>{v(s=>s+1)},a=J(o.name),R=p||y,g="pagination"in h&&h.pagination?h.pagination.total:0,E=(a.value?.connect??[]).filter(s=>h.results.findIndex(O=>O.id===s.id)===-1).length??0,F=a.value?.disconnect?.length??0,A=g+E-F,$=w.useMemo(()=>{const s={field:a.value,href:`../${oe}/${o.attribute.targetModel}`,mainField:o.mainField};return[...we(Ae(s),Ne(s),We(s))([...h.results]),...a.value?.connect??[]].sort((P,z)=>P.__temp_key__<z.__temp_key__?-1:P.__temp_key__>z.__temp_key__?1:0)},[h.results,a.value,o.attribute.targetModel,o.mainField]),C=le(o.name,"RelationsField"),L=s=>{const[O]=$.slice(-1),N={id:s.id,apiData:{id:s.id,documentId:s.documentId,locale:s.locale},status:s.status,__temp_key__:se(O?.__temp_key__??null,null,1)[0],[o.mainField?.name??"documentId"]:s[o.mainField?.name??"documentId"],label:re(s,o.mainField),href:`../${oe}/${o.attribute.targetModel}/${s.documentId}?${s.locale?`plugins[i18n][locale]=${s.locale}`:""}`};ce.includes(o.attribute.relation)?(a.value?.connect?.forEach(C),$.forEach(C),a.onChange(`${o.name}.connect`,[N])):a.onChange(`${o.name}.connect`,[...a.value?.connect??[],N])};return d.jsxs(B,{ref:c,direction:"column",gap:3,justifyContent:"space-between",alignItems:"stretch",wrap:"wrap",children:[d.jsxs(Pe,{direction:"column",alignItems:"start",gap:2,width:"100%",children:[d.jsx(Ue,{disabled:S,id:e?b?`${b}`:"":T,label:`${n} ${A>0?`(${A})`:""}`,model:m,onChange:L,...o}),"pagination"in h&&h.pagination&&h.pagination.pageCount>h.pagination.page?d.jsx(pe,{disabled:R,onClick:i,loading:R,startIcon:d.jsx(Ce,{}),shrink:0,children:M({id:k("relation.loadMore"),defaultMessage:"Load More"})}):null]}),d.jsx(mt,{data:$,serverData:h.results,disabled:S,name:o.name,isLoading:R,relationType:o.attribute.relation})]})}),ht=w.forwardRef(({disabled:t,label:n,...o},c)=>{const[u,v]=w.useState(1),{document:I,model:_}=Re(),T=I?.documentId,{formatMessage:M}=K(),[{query:D}]=he(),x=me(D),S=o.attribute.relation.toLowerCase().includes("morph")||t,{componentId:b,componentUID:e}=$e("RelationsField",({uid:s,id:O})=>({componentId:O,componentUID:s})),r=ne("RelationsList",s=>s.isSubmitting);w.useEffect(()=>{v(1)},[r]);const l=b?b.toString():T,m=e??_,[f]=o.name.split(".").slice(-1),{data:h,isLoading:p,isFetching:y}=ze({model:m,targetField:f,id:l,params:{...x,pageSize:W,page:u}},{refetchOnMountOrArgChange:!0,skip:!l,selectFromResult:s=>({...s,data:{...s.data,results:s.data?.results?s.data.results:[]}})}),i=()=>{v(s=>s+1)},a=J(o.name),R=p||y,g="pagination"in h&&h.pagination?h.pagination.total:0,E=(a.value?.connect??[]).filter(s=>h.results.findIndex(O=>O.id===s.id)===-1).length??0,F=a.value?.disconnect?.length??0,A=g+E-F,$=w.useMemo(()=>{const s={field:a.value,href:`../${oe}/${o.attribute.targetModel}`,mainField:o.mainField};return[...we(Ae(s),Ne(s),We(s))([...h.results]),...a.value?.connect??[]].sort((P,z)=>P.__temp_key__<z.__temp_key__?-1:P.__temp_key__>z.__temp_key__?1:0)},[h.results,a.value,o.attribute.targetModel,o.mainField]),C=le(o.name,"RelationsField"),L=s=>{const[O]=$.slice(-1),N={id:s.id,apiData:{id:s.id,documentId:s.documentId,locale:s.locale},status:s.status,__temp_key__:se(O?.__temp_key__??null,null,1)[0],[o.mainField?.name??"documentId"]:s[o.mainField?.name??"documentId"],label:re(s,o.mainField),href:`../${oe}/${o.attribute.targetModel}/${s.documentId}?${s.locale?`plugins[i18n][locale]=${s.locale}`:""}`};ce.includes(o.attribute.relation)?(a.value?.connect?.forEach(C),$.forEach(C),a.onChange(`${o.name}.connect`,[N])):a.onChange(`${o.name}.connect`,[...a.value?.connect??[],N])};return d.jsxs(B,{ref:c,direction:"column",gap:3,justifyContent:"space-between",alignItems:"stretch",wrap:"wrap",children:[d.jsxs(Pe,{direction:"column",alignItems:"start",gap:2,width:"100%",children:[d.jsx(Ue,{disabled:S,id:e?b?`${b}`:"":T,label:`${n} ${A>0?`(${A})`:""}`,model:m,onChange:L,...o}),"pagination"in h&&h.pagination&&h.pagination.pageCount>h.pagination.page?d.jsx(pe,{disabled:R,onClick:i,loading:R,startIcon:d.jsx(Ce,{}),shrink:0,children:M({id:k("relation.loadMore"),defaultMessage:"Load More"})}):null]}),d.jsx(pt,{data:$,serverData:h.results,disabled:S,name:o.name,isLoading:R,relationType:o.attribute.relation})]})}),Pe=Q(B)`
  & > div {
    width: 100%;
  }
`,Ae=({field:t})=>n=>n.filter(o=>(t?.connect??[]).findIndex(u=>u.id===o.id)===-1),Ne=({field:t})=>n=>n.filter(o=>(t?.disconnect??[]).findIndex(u=>u.id===o.id)===-1),We=({mainField:t,href:n})=>o=>o.map(c=>({...c,[t?.name??"documentId"]:c[t?.name??"documentId"],label:re(c,t),href:`${n}/${c.documentId}?${c.locale?`plugins[i18n][locale]=${c.locale}`:""}`})),Ue=({hint:t,id:n,model:o,label:c,labelAction:u,name:v,mainField:I,placeholder:_,required:T,unique:M,"aria-label":D,onChange:x,...j})=>{const[S,b]=w.useState(""),[e,r]=w.useState({_q:"",page:1}),{toggleNotification:l}=Qe(),[{query:m}]=he(),{formatMessage:f}=K(),h=Je(v),p=J(v),y=tt(e,300),[i,{data:a,isLoading:R}]=nt();w.useEffect(()=>{const[C]=v.split(".").slice(-1);i({model:o,targetField:C,params:{...me(m),id:n??"",pageSize:10,idsToInclude:p.value?.disconnect?.map(L=>L.id.toString())??[],idsToOmit:p.value?.connect?.map(L=>L.id.toString())??[],...y}})},[p.value?.connect,p.value?.disconnect,n,o,v,m,i,y]);const g=async C=>{r(L=>({...L,_q:C,page:1}))},E=a?.pagination?a.pagination.page<a.pagination.pageCount:!1,F=a?.results??[],A=C=>{if(!C)return;const L=F.find(s=>s.id.toString()===C);if(!L){console.error("You've tried to add a relation with an id that does not exist in the options you can see, this is likely a bug with Strapi. Please open an issue."),l({message:f({id:k("relation.error-adding-relation"),defaultMessage:"An error occurred while trying to add the relation."}),type:"danger"});return}x(L)},$=()=>{!a||!a.pagination||a.pagination.page<a.pagination.pageCount&&r(C=>({...C,page:C.page+1}))};return w.useLayoutEffect(()=>{b("")},[p.value]),d.jsxs(Z.Root,{error:p.error,hint:t,name:v,required:T,children:[d.jsx(Z.Label,{action:u,children:c}),d.jsx(Xe,{ref:h,name:v,autocomplete:"list",placeholder:_||f({id:k("relation.add"),defaultMessage:"Add relation"}),hasMoreItems:E,loading:R,onOpenChange:()=>{g(S??"")},noOptionsMessage:()=>f({id:k("relation.notAvailable"),defaultMessage:"No relations available"}),loadingMessage:f({id:k("relation.isLoading"),defaultMessage:"Relations are loading"}),onLoadMore:$,textValue:S,onChange:A,onTextValueChange:C=>{b(C)},onInputChange:C=>{g(C.currentTarget.value)},...j,children:F.map(C=>{const L=re(C,I);return d.jsx(Ze,{value:C.id.toString(),textValue:L,children:d.jsxs(B,{gap:2,justifyContent:"space-between",children:[d.jsx(Te,{ellipsis:!0,children:L}),C.status?d.jsx(fe,{status:C.status}):null]})},C.id)})}),d.jsx(Z.Error,{}),d.jsx(Z.Hint,{})]})},H=50,q=4,mt=({data:t,serverData:n,disabled:o,name:c,isLoading:u,relationType:v})=>{const I=w.useId(),{formatMessage:_}=K(),T=w.useRef(null),M=w.useRef(null),[D,x]=w.useState(),[j,S]=w.useState(""),b=J(c);w.useEffect(()=>{if(t.length<=W)return x(void 0);const i=R=>{const g=R.target,E=g.parentNode.scrollHeight,F=g.scrollHeight-g.scrollTop;return g.scrollTop===0?x("bottom"):x(F===E?"top":"top-bottom")},a=M?.current;return!u&&t.length>0&&a&&M.current.addEventListener("scroll",i),()=>{a&&a.removeEventListener("scroll",i)}},[u,t.length]);const e=i=>`${i+1} of ${t.length}`,r=(i,a)=>{const R=t[a];S(_({id:k("dnd.reorder"),defaultMessage:"{item}, moved. New position in list: {position}."},{item:R.label??R.documentId,position:e(i)}));const g=[...t],E=t[a],F=a>i?g[i-1]?.__temp_key__:g[i]?.__temp_key__,A=a>i?g[i]?.__temp_key__:g[i+1]?.__temp_key__,[$]=se(F,A,1);g.splice(a,1),g.splice(i,0,{...E,__temp_key__:$});const C=g.reduce((L,s,O,N)=>{const P=n.find(U=>U.id===s.id),z=N[O+1];if(!P||P.__temp_key__!==s.__temp_key__){const U=z?{before:z.documentId,locale:z.locale,status:"publishedAt"in z&&z.publishedAt?"published":"draft"}:{end:!0},G={...s,apiData:{id:s.id,documentId:s.documentId,locale:s.locale,position:U}};return[...L,G]}return L},[]).toReversed();b.onChange(`${c}.connect`,C)},l=i=>{const a=t[i];S(_({id:k("dnd.grab-item"),defaultMessage:"{item}, grabbed. Current position in list: {position}. Press up and down arrow to change position, Spacebar to drop, Escape to cancel."},{item:a.label??a.documentId,position:e(i)}))},m=i=>{const{href:a,label:R,...g}=t[i];S(_({id:k("dnd.drop-item"),defaultMessage:"{item}, dropped. Final position in list: {position}."},{item:R??g.documentId,position:e(i)}))},f=i=>{const a=t[i];S(_({id:k("dnd.cancel-item"),defaultMessage:"{item}, dropped. Re-order cancelled."},{item:a.label??a.documentId}))},h=le(c,"RelationsList"),p=!ce.includes(v),y=t.length>W?Math.min(t.length,W)*(H+q)+H/2:Math.min(t.length,W)*(H+q);return d.jsxs(Be,{$overflowDirection:D,children:[d.jsx(ie,{id:I,children:_({id:k("dnd.instructions"),defaultMessage:"Press spacebar to grab and re-order"})}),d.jsx(ie,{"aria-live":"assertive",children:j}),d.jsx(Fe,{height:y,ref:T,outerRef:M,itemCount:t.length,itemSize:H+q,itemData:{ariaDescribedBy:I,canDrag:p,disabled:o,handleCancel:f,handleDropItem:m,handleGrabItem:l,handleMoveItem:r,name:c,handleDisconnect:h,relations:t},itemKey:i=>t[i].id,innerElementType:"ol",children:gt})]})},pt=({data:t,serverData:n,disabled:o,name:c,isLoading:u,relationType:v})=>{const I=w.useId(),{formatMessage:_}=K(),T=w.useRef(null),M=w.useRef(null),[D,x]=w.useState(),[j,S]=w.useState(""),b=J(c);w.useEffect(()=>{if(t.length<=W)return x(void 0);const i=R=>{const g=R.target,E=g.parentNode.scrollHeight,F=g.scrollHeight-g.scrollTop;return g.scrollTop===0?x("bottom"):x(F===E?"top":"top-bottom")},a=M?.current;return!u&&t.length>0&&a&&M.current.addEventListener("scroll",i),()=>{a&&a.removeEventListener("scroll",i)}},[u,t.length]);const e=i=>`${i+1} of ${t.length}`,r=(i,a)=>{const R=t[a];S(_({id:k("dnd.reorder"),defaultMessage:"{item}, moved. New position in list: {position}."},{item:R.label??R.documentId,position:e(i)}));const g=[...t],E=t[a],F=a>i?g[i-1]?.__temp_key__:g[i]?.__temp_key__,A=a>i?g[i]?.__temp_key__:g[i+1]?.__temp_key__,[$]=se(F,A,1);g.splice(a,1),g.splice(i,0,{...E,__temp_key__:$});const C=g.reduce((L,s,O,N)=>{const P=n.find(U=>U.id===s.id),z=N[O+1];if(!P||P.__temp_key__!==s.__temp_key__){const U=z?{before:z.documentId,locale:z.locale,status:"publishedAt"in z&&z.publishedAt?"published":"draft"}:{end:!0},G={...s,apiData:{id:s.id,documentId:s.documentId,locale:s.locale,position:U}};return[...L,G]}return L},[]).toReversed();b.onChange(`${c}.connect`,C)},l=i=>{const a=t[i];S(_({id:k("dnd.grab-item"),defaultMessage:"{item}, grabbed. Current position in list: {position}. Press up and down arrow to change position, Spacebar to drop, Escape to cancel."},{item:a.label??a.documentId,position:e(i)}))},m=i=>{const{href:a,label:R,...g}=t[i];S(_({id:k("dnd.drop-item"),defaultMessage:"{item}, dropped. Final position in list: {position}."},{item:R??g.documentId,position:e(i)}))},f=i=>{const a=t[i];S(_({id:k("dnd.cancel-item"),defaultMessage:"{item}, dropped. Re-order cancelled."},{item:a.label??a.documentId}))},h=le(c,"RelationsList"),p=!ce.includes(v),y=t.length>W?Math.min(t.length,W)*(H+q)+H/2:Math.min(t.length,W)*(H+q);return d.jsxs(Be,{$overflowDirection:D,children:[d.jsx(ie,{id:I,children:_({id:k("dnd.instructions"),defaultMessage:"Press spacebar to grab and re-order"})}),d.jsx(ie,{"aria-live":"assertive",children:j}),d.jsx(Fe,{height:y,ref:T,outerRef:M,itemCount:t.length,itemSize:H+q,itemData:{ariaDescribedBy:I,canDrag:p,disabled:o,handleCancel:f,handleDropItem:m,handleGrabItem:l,handleMoveItem:r,name:c,handleDisconnect:h,relations:t},itemKey:i=>t[i].id,innerElementType:"ol",children:vt})]})},Be=Q(V)`
  position: relative;
  overflow: hidden;
  flex: 1;

  &:before,
  &:after {
    position: absolute;
    width: 100%;
    height: 4px;
    z-index: 1;
  }

  &:before {
    /* TODO: as for DS Table component we would need this to be handled by the DS theme */
    content: '';
    background: linear-gradient(rgba(3, 3, 5, 0.2) 0%, rgba(0, 0, 0, 0) 100%);
    top: 0;
    opacity: ${({$overflowDirection:t})=>t==="top-bottom"||t==="top"?1:0};
    transition: opacity 0.2s ease-in-out;
  }

  &:after {
    /* TODO: as for DS Table component we would need this to be handled by the DS theme */
    content: '';
    background: linear-gradient(0deg, rgba(3, 3, 5, 0.2) 0%, rgba(0, 0, 0, 0) 100%);
    bottom: 0;
    opacity: ${({$overflowDirection:t})=>t==="top-bottom"||t==="bottom"?1:0};
    transition: opacity 0.2s ease-in-out;
  }
`,ft=Q(pe)`
  & > span {
    font-size: ${({theme:t})=>t.fontSizes[2]};
  }
`,gt=({data:t,index:n,style:o})=>{const{ariaDescribedBy:c,canDrag:u=!1,disabled:v=!1,handleCancel:I,handleDisconnect:_,handleDropItem:T,handleGrabItem:M,handleMoveItem:D,name:x,relations:j}=t,{formatMessage:S}=K(),{id:b,label:e,status:r}=j[n],[{handlerId:l,isDragging:m,handleKeyDown:f},h,p,y,i]=je(u&&!v,{type:`${Oe.RELATION}_${x}`,index:n,item:{displayedValue:e,status:r,id:b,index:n},onMoveItem:D,onDropItem:T,onGrabItem:M,onCancel:I,dropSensitivity:ke.REGULAR}),a=xe(h,y);return w.useEffect(()=>{i(Ee())},[i]),d.jsx(V,{style:o,tag:"li",ref:p,"aria-describedby":c,cursor:u?"all-scroll":"default",children:m?d.jsx(Ve,{}):d.jsxs(B,{paddingTop:2,paddingBottom:2,paddingLeft:u?2:4,paddingRight:4,hasRadius:!0,borderColor:"neutral200",background:v?"neutral150":"neutral0",justifyContent:"space-between",ref:a,"data-handler-id":l,children:[d.jsxs(He,{gap:1,children:[u?d.jsx(ae,{tag:"div",role:"button",tabIndex:0,withTooltip:!1,label:S({id:k("components.RelationInput.icon-button-aria-label"),defaultMessage:"Drag"}),variant:"ghost",onKeyDown:f,disabled:v,children:d.jsx(Me,{})}):null,d.jsxs(B,{width:"100%",minWidth:0,justifyContent:"space-between",children:[d.jsx(V,{minWidth:0,paddingTop:1,paddingBottom:1,paddingRight:4,children:d.jsx(De,{description:e,children:d.jsx(ft,{onClick:()=>console.log("OPEN MODAL"),children:e})})}),r?d.jsx(fe,{status:r}):null]})]}),d.jsx(V,{paddingLeft:4,children:d.jsx(ae,{onClick:()=>_(j[n]),disabled:v,label:S({id:k("relation.disconnect"),defaultMessage:"Remove"}),variant:"ghost",size:"S",children:d.jsx(Le,{})})})]})})},vt=({data:t,index:n,style:o})=>{const{ariaDescribedBy:c,canDrag:u=!1,disabled:v=!1,handleCancel:I,handleDisconnect:_,handleDropItem:T,handleGrabItem:M,handleMoveItem:D,name:x,relations:j}=t,{formatMessage:S}=K(),{href:b,id:e,label:r,status:l}=j[n],[{handlerId:m,isDragging:f,handleKeyDown:h},p,y,i,a]=je(u&&!v,{type:`${Oe.RELATION}_${x}`,index:n,item:{displayedValue:r,status:l,id:e,index:n},onMoveItem:D,onDropItem:T,onGrabItem:M,onCancel:I,dropSensitivity:ke.REGULAR}),R=xe(p,i);return w.useEffect(()=>{a(Ee())},[a]),d.jsx(V,{style:o,tag:"li",ref:y,"aria-describedby":c,cursor:u?"all-scroll":"default",children:f?d.jsx(Ve,{}):d.jsxs(B,{paddingTop:2,paddingBottom:2,paddingLeft:u?2:4,paddingRight:4,hasRadius:!0,borderColor:"neutral200",background:v?"neutral150":"neutral0",justifyContent:"space-between",ref:R,"data-handler-id":m,children:[d.jsxs(He,{gap:1,children:[u?d.jsx(ae,{tag:"div",role:"button",tabIndex:0,withTooltip:!1,label:S({id:k("components.RelationInput.icon-button-aria-label"),defaultMessage:"Drag"}),variant:"ghost",onKeyDown:h,disabled:v,children:d.jsx(Me,{})}):null,d.jsxs(B,{width:"100%",minWidth:0,justifyContent:"space-between",children:[d.jsx(V,{minWidth:0,paddingTop:1,paddingBottom:1,paddingRight:4,children:d.jsx(De,{description:r,children:b?d.jsx(bt,{tag:et,to:b,isExternal:!1,children:r}):d.jsx(Te,{textColor:v?"neutral600":"primary600",ellipsis:!0,children:r})})}),l?d.jsx(fe,{status:l}):null]})]}),d.jsx(V,{paddingLeft:4,children:d.jsx(ae,{onClick:()=>_(j[n]),disabled:v,label:S({id:k("relation.disconnect"),defaultMessage:"Remove"}),variant:"ghost",size:"S",children:d.jsx(Le,{})})})]})})},He=Q(B)`
  width: 100%;
  /* Used to prevent endAction to be pushed out of container */
  min-width: 0;

  & > div[role='button'] {
    cursor: all-scroll;
  }
`,wt=Q.button`
  svg path {
    fill: ${({theme:t,disabled:n})=>n?t.colors.neutral600:t.colors.neutral500};
  }

  &:hover svg path,
  &:focus svg path {
    fill: ${({theme:t,disabled:n})=>!n&&t.colors.neutral600};
  }
`,bt=Q(Ge)`
  display: block;

  & > span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: block;
  }
`,Ve=()=>d.jsx(V,{paddingTop:2,paddingBottom:2,paddingLeft:4,paddingRight:4,hasRadius:!0,borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",background:"primary100",height:`calc(100% - ${q}px)`}),Ct=w.memo(ht),Tt=w.memo(ut);export{Rt as C,wt as D,He as F,bt as L,Tt as M,Ct as a,$e as u};
