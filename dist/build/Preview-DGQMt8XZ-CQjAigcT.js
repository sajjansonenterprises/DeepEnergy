import{cb as q,j as e,cc as $,cd as z,aP as M,n as N,P as g,B as v,cf as G,aY as Q,u as x,a9 as C,r as E,cj as Y,cl as Z,eo as X,cg as _,ch as J,a1 as K,F as f,ep as S,bL as ee,i as A,b5 as F,I as k,dt as R,eq as te,er as se,es as B,S as y,d as T,et as P,aZ as ne,ax as ae,bj as oe,T as re,ct as ie,bZ as L,cm as ce}from"./strapi-Cdgn8T7P.js";import{F as de}from"./Input-BrTcf7W8-B2WzftPV.js";import{getDocumentStatus as D}from"./EditViewPage-B9oaTSxh-Dxcw9cBD.js";import"./Relations-BemEu63h-BsFQ-4xJ.js";import"./relations-De8hSklO-P8smWhL7.js";import"./usePrev-Bjw2dhmq-CGZJVkWT.js";import"./useDragAndDrop-HYwNDExe-ulySukYe.js";import"./objects-wl73iEma-CRb5a3ie.js";import"./ComponentIcon-BZcTc4rj-t92dm1Vm.js";import"./getEmptyImage-CjqolaH3.js";const le=T(ce)`
  will-change: transform;
  rotate: ${t=>t.isSideEditorOpen?"0deg":"180deg"};
  transition: rotate 0.2s ease-in-out;
`,ue=()=>{const t=l("PreviewContent",a=>a.url),o=l("PreviewContent",a=>a.layout),{formatMessage:s}=x(),[r,c]=E.useState(!0);return e.jsxs(f,{flex:1,overflow:"auto",alignItems:"stretch",children:[e.jsx(v,{overflow:"auto",width:r?"50%":0,borderWidth:"0 1px 0 0",borderColor:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:r?6:0,paddingRight:r?6:0,transition:"all 0.2s ease-in-out",children:e.jsx(de,{layout:o.layout,hasBackground:!0})}),e.jsxs(v,{position:"relative",flex:1,height:"100%",overflow:"hidden",children:[e.jsx(v,{src:t,title:s({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"},t),e.jsx(k,{variant:"tertiary",label:s(r?{id:"content-manager.preview.content.close-editor",defaultMessage:"Close editor"}:{id:"content-manager.preview.content.open-editor",defaultMessage:"Open editor"}),onClick:()=>c(a=>!a),position:"absolute",top:2,left:2,children:e.jsx(le,{isSideEditorOpen:r})})]})]})},pe=()=>{const t=l("PreviewContent",s=>s.url),{formatMessage:o}=x();return e.jsx(v,{src:t,title:o({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"},t)},H=()=>{const[{query:t}]=C(),{formatMessage:o}=x(),s=P("BackButton",d=>d.canGoBack),r=P("BackButton",d=>d.goBack),c=P("BackButton",d=>d.history),a=P("BackButton",d=>d.currentLocationIndex),p=s?c.at(a-2):void 0,h={pathname:"..",search:ne.stringify(t,{encode:!1})},n=p??h,i=d=>{if(s){d.preventDefault(),r();return}};return e.jsx(k,{variant:"ghost",tag:ae,relative:"path",to:n,onClick:i,label:o({id:"content-manager.preview.header.close",defaultMessage:"Close preview"}),children:e.jsx(oe,{})})},W=()=>{const t=l("PreviewHeader",a=>a.document),o=l("PreviewHeader",a=>a.schema),s=l("PreviewHeader",a=>a.meta);if(!(o?.options?.draftAndPublish??!1))return null;const c=D(t,s);return e.jsx(ie,{status:c,size:"XS"})},O=()=>{const{formatMessage:t}=x(),[{query:o},s]=C(),r=l("PreviewHeader",i=>i.document),c=l("PreviewHeader",i=>i.schema),a=l("PreviewHeader",i=>i.meta),p=c?.options?.draftAndPublish??!1,h=D(r,a),n=i=>{(i==="published"||i==="draft")&&s({status:i},"push",!0)};return p?e.jsx(L.Root,{variant:"simple",value:o.status||"draft",onValueChange:n,children:e.jsxs(L.List,{"aria-label":t({id:"preview.tabs.label",defaultMessage:"Document status"}),children:[e.jsx(I,{value:"draft",children:t({id:"content-manager.containers.List.draft",defaultMessage:"draft"})}),e.jsx(I,{value:"published",disabled:h==="draft",children:t({id:"content-manager.containers.List.published",defaultMessage:"published"})})]})}):null},he=()=>{const t=l("PreviewHeader",u=>u.title),o=l("PreviewHeader",u=>u.document),s=l("PreviewHeader",u=>u.schema),r=l("PreviewHeader",u=>u.meta),c=ee("PreviewHeader",u=>u.plugins),[{query:a}]=C(),{formatMessage:p}=x(),{toggleNotification:h}=A(),{copy:n}=F(),i=()=>{n(window.location.href),h({message:p({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})},d=s.options?.draftAndPublish??!1,b={activeTab:a.status??null,collectionType:s.kind==="collectionType"?"collection-types":"single-types",model:s.uid,documentId:o.documentId,document:o,meta:r};return e.jsxs(f,{height:"48px",gap:4,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(ge,{height:"100%",paddingLeft:2,paddingRight:4,children:[e.jsx(H,{}),e.jsx(U,{tag:"h1",title:t,maxWidth:"200px",fontSize:2,paddingLeft:2,paddingRight:3,fontWeight:600,children:t}),e.jsx(W,{})]}),e.jsxs(f,{flex:1,paddingRight:2,gap:2,justifyContent:d?"space-between":"flex-end",children:[e.jsx(f,{flex:"1 1 70%",children:e.jsx(O,{})}),e.jsxs(f,{gap:2,children:[e.jsx(k,{type:"button",label:p({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:i,children:e.jsx(R,{})}),e.jsx(te,{area:"preview.actions"}),e.jsx(se,{props:b,descriptions:c["content-manager"].apis.getDocumentActions("preview"),children:u=>{const j=u.filter(V=>[V.position].flat().includes("preview")),[m,w]=j;return!m&&!w?null:m&&w?e.jsxs(e.Fragment,{children:[e.jsx(B,{...w,variant:w.variant||"secondary"}),e.jsx(B,{...m,variant:m.variant||"default"})]}):e.jsx(B,{...m,variant:m.variant||"secondary"})}})]})]})]})},me=()=>{const t=l("PreviewHeader",a=>a.title),{formatMessage:o}=x(),{toggleNotification:s}=A(),{copy:r}=F(),c=()=>{r(window.location.href),s({message:o({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})};return e.jsxs(y.Root,{gap:3,gridCols:3,paddingLeft:2,paddingRight:2,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(y.Item,{xs:1,paddingTop:2,paddingBottom:2,gap:3,children:[e.jsx(H,{}),e.jsx(U,{tag:"h1",fontWeight:600,fontSize:2,maxWidth:"200px",title:t,children:t}),e.jsx(W,{})]}),e.jsx(y.Item,{xs:1,marginBottom:"-1px",alignItems:"end",margin:"auto",children:e.jsx(O,{})}),e.jsx(y.Item,{xs:1,justifyContent:"end",paddingTop:2,paddingBottom:2,children:e.jsx(k,{type:"button",label:o({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:c,children:e.jsx(R,{})})})]})},U=T(re)`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,I=T(L.Trigger)`
  text-transform: uppercase;
`,ge=T(f)`
  border-right: 1px solid ${({theme:t})=>t.colors.neutral150};
`,[fe,l]=q("PreviewPage"),xe=()=>{const t=Q(),{formatMessage:o}=x(),{slug:s,id:r,collectionType:c}=M(),[{query:a}]=C(),p=E.useMemo(()=>Y(a),[a]);if(!c)throw new Error("Could not find collectionType in url params");if(!s)throw new Error("Could not find model in url params");if(c===Z&&!r)throw new Error("Could not find documentId in url params");const h=X({params:{contentType:s},query:{documentId:r,locale:p.locale,status:p.status}}),n=_({model:s,collectionType:c,documentId:r,params:p}),i=J(s);if(n.isLoading||h.isLoading||i.isLoading)return e.jsx(g.Loading,{});const d=n.getInitialFormValues();if(h.error||i.error||!n.document||!n.meta||!n.schema||!d)return e.jsx(g.Error,{});if(!h.data?.data?.url)return e.jsx(g.NoData,{});const b=n.getTitle(i.edit.settings.mainField),u=(j,m)=>S(n.schema?.attributes,n.components,{status:n.document?.status,...m}).validateSync(j,{abortEarly:!1});return e.jsxs(e.Fragment,{children:[e.jsx(g.Title,{children:o({id:"content-manager.preview.page-title",defaultMessage:"{contentType} preview"},{contentType:b})}),e.jsx(fe,{url:h.data.data.url,document:n.document,title:b,meta:n.meta,schema:n.schema,layout:i.edit,children:e.jsx(K,{method:"PUT",disabled:a.status==="published"&&n&&n.document.status==="published",initialValues:n.getInitialFormValues(),initialErrors:t?.state?.forceValidation?u(d,{}):{},height:"100%",validate:(j,m)=>S(n.schema?.attributes,n.components,{status:n.document?.status,...m}).validate(j,{abortEarly:!1}),children:e.jsx(f,{direction:"column",height:"100%",alignItems:"stretch",children:window.strapi.future.isEnabled("unstablePreviewSideEditor")?e.jsxs(e.Fragment,{children:[e.jsx(he,{}),e.jsx(ue,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsx(pe,{})]})})})})]})},we=()=>{const{slug:t}=M(),{permissions:o=[],isLoading:s,error:r}=N([{action:"plugin::content-manager.explorer.read",subject:t},{action:"plugin::content-manager.explorer.update",subject:t},{action:"plugin::content-manager.explorer.publish",subject:t}]);return s?e.jsx(g.Loading,{}):r||!t?e.jsx(v,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(g.Error,{})}):e.jsx(v,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(g.Protect,{permissions:o.filter(c=>c.action.includes("explorer.read")),children:e.jsx(G,{permissions:o,children:e.jsx(xe,{})})})})},Se=()=>e.jsx($,{children:e.jsx(z,{children:e.jsx(we,{})})});export{Se as ProtectedPreviewPage,l as usePreviewContext};
